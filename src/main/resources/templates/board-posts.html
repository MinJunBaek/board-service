<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
  <head>
    <meta charset="UTF-8">
    <title>게시글 목록</title>

    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
    >
  </head>
  <body>
    <!-- ===== 네비게이션 바 ===== -->
    <div th:replace="fragments/navbar :: navbar"></div>

    <!-- ===== 본문: 게시글 목록 ===== -->
    <div class="container mt-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h2 th:text="${boardName}">게시글 목록</h2>
          <p class="text-muted mb-0">이 게시판에 등록된 게시글입니다.</p>
        </div>

        <!-- 글쓰기 버튼 -->
        <a class="btn btn-primary"
           th:href="@{|/boards/${boardId}/posts-form|}">
          글쓰기
        </a>
      </div>

      <!-- 게시글이 없는 경우 -->
      <div class="alert alert-info" th:if="${#lists.isEmpty(posts)}">
        아직 작성된 게시글이 없습니다. 첫 글의 주인공이 되어보세요!
      </div>

      <!-- 게시글 목록 테이블 -->
      <table class="table table-hover" th:if="${!#lists.isEmpty(posts)}">
        <thead class="table-light">
        <tr>
          <th style="width: 80px;">번호</th>
          <th>제목</th>
          <th style="width: 100px;">좋아요</th>
          <th style="width: 100px;">조회수</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="post, stat : ${posts}">
          <!-- 번호 -->
          <td th:text="${stat.count}">1</td>

          <!-- 제목 + (오른쪽에) 수정/삭제 버튼 -->
          <td>
            <div class="d-flex justify-content-between align-items-center">
              <!-- 제목 링크 -->
              <a th:href="@{|/posts/${post.id}|}"
                 th:text="${post.title}">
                게시글 제목
              </a>

              <!-- 🔹 로그인 + 작성자 본인일 때만 버튼 노출 -->
              <div th:if="${loggedIn and memberPrincipalName == post.memberName}"
                   class="d-inline-flex gap-1 ms-2">

                <!-- 수정 버튼: 삭제와 같은 형태의 button -->
                <form th:action="@{|/posts/${post.id}/posts-form|}" method="get"
                      class="m-0 d-inline-block">
                  <button type="submit" class="btn btn-outline-primary btn-sm">
                    수정
                  </button>
                </form>

                <!-- 삭제 버튼 -->
                <form th:action="@{|/boards/${boardId}/posts/${post.id}|}" method="post"
                      class="m-0 d-inline-block"
                      onsubmit="return confirm('정말 삭제하시겠습니까?');">
                  <input type="hidden" name="_method" value="delete"/>
                  <button type="submit" class="btn btn-outline-danger btn-sm">
                    삭제
                  </button>
                </form>
              </div>
            </div>
          </td>

          <!-- 좋아요 / 조회수 -->
          <td th:text="${post.likeCount}">0</td>
          <td th:text="${post.viewCount}">0</td>
        </tr>
        </tbody>
      </table>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
