<!-- post-list.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
  <head>
    <meta charset="UTF-8" />
  </head>
  <body>
    <!-- ê²Œì‹œê¸€ ëª©ë¡ ê³µí†µ Fragment -->
    <div th:fragment="postList(postsPage, posts, loggedIn, memberPrincipalId, url)">

      <!-- ê²Œì‹œê¸€ì´ ì—†ëŠ” ê²½ìš° -->
      <div class="alert alert-info" th:if="${#lists.isEmpty(posts)}">
        ì•„ì§ ì‘ì„±ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
      </div>

      <!-- ê²Œì‹œê¸€ ëª©ë¡ í…Œì´ë¸” -->
      <table class="table table-hover" th:if="${!#lists.isEmpty(posts)}">
        <thead class="table-light">
        <tr>
          <th style="width: 80px;">ë²ˆí˜¸</th>
          <th>ì œëª©</th>
          <th style="width: 100px;">ì‘ì„±ì</th>
          <th style="width: 100px;">ì¢‹ì•„ìš”</th>
          <th style="width: 100px;">ì¡°íšŒìˆ˜</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="post : ${posts}">
          <!-- ë²ˆí˜¸ -->
          <td th:text="${post.id}">1</td>
          <!-- ì œëª© + (ì˜¤ë¥¸ìª½ì—) ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ -->
          <td>
            <div class="d-flex justify-content-between align-items-center">
              <!-- ì œëª© ë§í¬ -->
              <a th:href="@{|/posts/${post.id}/posts-form|}"
                 th:text="${post.title}">
                ê²Œì‹œê¸€ ì œëª©
              </a>

              <!-- ğŸ”¹ ë¡œê·¸ì¸ + ì‘ì„±ì ë³¸ì¸ì¼ ë•Œë§Œ ë²„íŠ¼ ë…¸ì¶œ -->
              <div th:if="${loggedIn and memberPrincipalId == post.memberId}"
                   class="d-inline-flex gap-1 ms-2">
                <!-- ìˆ˜ì • ë²„íŠ¼ -->
                <form th:action="@{|/posts/${post.id}/posts-edit-form|}" method="get"
                      class="m-0 d-inline-block">
                  <button type="submit" class="btn btn-outline-primary btn-sm">
                    ìˆ˜ì •
                  </button>
                </form>

                <!-- ì‚­ì œ ë²„íŠ¼ -->
                <form th:action="@{|/posts/${post.id}|}" method="post"
                      class="m-0 d-inline-block"
                      onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                  <input type="hidden" name="_method" value="delete"/>
                  <button type="submit" class="btn btn-outline-danger btn-sm">
                    ì‚­ì œ
                  </button>
                </form>
              </div>
            </div>
          </td>

          <!-- ì‘ì„±ì -->
          <td>
            <div th:text="${post.memberName}">
              ì‘ì„±ì
            </div>
          </td>

          <!-- ì¢‹ì•„ìš” / ì¡°íšŒìˆ˜ -->
          <td th:text="${post.likeCount}">0</td>
          <td th:text="${post.viewCount}">0</td>

        </tr>
        </tbody>
      </table>

      <!-- ===== í˜ì´ì§€ë„¤ì´ì…˜ ===== -->
      <nav th:if="${postsPage != null and postsPage.totalPages > 1}"
           th:with="start=${T(java.lang.Math).floor(postsPage.number/10)*10 + 1},
           end=(${start + 9 < postsPage.totalPages ? start + 9 : postsPage.totalPages})"
           aria-label="Page navigation">
        <ul class="pagination justify-content-center">

          <!-- ì´ì „ í˜ì´ì§€ ë²„íŠ¼: ì²« í˜ì´ì§€ì¼ ê²½ìš° ë¹„í™œì„±í™” -->
          <li class="page-item" th:classappend="${postsPage.first} ? 'disabled'">
            <a class="page-link" th:href="@{${url}(page=${postsPage.number - 1})}" aria-label="Previous">
              <span aria-hidden="true">&laquo;</span>
            </a>
          </li>

          <!-- í˜ì´ì§€ ë²ˆí˜¸ ë§í¬ë“¤: startë¶€í„° endê¹Œì§€ ìˆ«ìë¥¼ ë°˜ë³µí•˜ë©° ë§í¬ ìƒì„± -->
          <li class="page-item" th:each="page: ${#numbers.sequence(start, end)}"
              th:classappend="${page == postsPage.number + 1} ? 'active'">
            <a class="page-link" th:text="${page}" th:href="@{${url}(page=${page - 1})}"></a>
          </li>

          <!-- ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼: ë§ˆì§€ë§‰ í˜ì´ì§€ì¼ ê²½ìš° ë¹„í™œì„±í™” -->
          <li class="page-item" th:classappend="${postsPage.last} ? 'disabled'">
            <a class="page-link" th:href="@{${url}(page=${postsPage.number + 1})}" aria-label="Next">
              <span aria-hidden="true">&laquo;</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </body>
</html>